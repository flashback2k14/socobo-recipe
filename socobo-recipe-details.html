<link href="elements.html" rel="import">
<dom-module id="socobo-recipe-details">
  <style>
    :host {
      display: block;
    }

    .wrapper {
      background-color: white;
      width: 90%;
      min-width:700px;

      color: var(--primary-text-color);
      font-family: sans-serif;
      border-radius: 5px;
      line-height: 2;
      padding: 0;
    }

    #dialog{
      margin-top : 20px;
      margin-bottom: 0;
      top: 20px;
      min-height: 85vh;
    }
    .content {
      @apply(--layout-horizontal);
    }

    .leftColumn {
      width: 300px;
      padding: 30px;
      padding-top: 0;
    }

    .rightColumn {
      width: 100%;
      margin-right: 0px;
      padding: 30px;
      padding-top: 0;
      overflow: hidden;
    }

    .wrapper h1 {
      z-index: 15;
      padding-left: 30px;
      margin: 0;
      letter-spacing: -1px;
      color: #8A7F80;
      font-weight: 400;
      font-size: 30px;
    }

    .recipeImg {
      background-color: gainsboro;
      width: 280px;
      height: 280px;
      margin-bottom: 20px;
    }


    .text {
      vertical-align: text-top;
      margin-bottom: 40px;
      text-align: justify;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .step {
      width: 100%;
    }

    #exit iron-icon{
      width: 30px;
      height: 30px;
      float: right;
    }

    #exit{
      width: 100%;
      height: 100%;
      line-height: 50px;
      position: absolute;
      padding: 0;
      margin: 0;
      top:0px;
      right: 0px;
      color: #8A7F80;
      font-weight: 100;
    }


    #exit:hover {
      color: var(--accent-color);
      cursor: pointer;
    }

    .content {
      padding: 0;
      margin: 0;
      padding-top: 0;
    }

    .default{
      display: block;
    }

    .input{
      display: none;
    }

    #title_input{
      padding: 0;
      padding-left: 30px;
      padding-right: 30px;
    }

    .step_input paper-input{
      @apply(--layout-flex);
      padding-right: 30px;
      width: 800px;
    }

    .step_input paper-icon-button{
      width:40px;
      height: 40px;
      line-height: 40px;
      text-align: center;
    }

    #addStep, #addIncr{
      position: relative;
      left: 50%;
      margin-top: 10px;
      margin-left: -28px;
    }

    #addIncr{
      margin-top: 80px;
    }

    .buttons {
      float: right;
      margin: 20px;
    }

    .buttons paper-fab{
      margin: 10px;
    }

    #abort{
      --paper-fab-background: var(--default-primary-color);
    }

  </style>
  <template>
      <paper-dialog elevation="0" class="wrapper" id="dialog" modal
                    entry-animation="scale-up-animation"
                    exit-animation="fade-out-animation"
                    with-backdrop>
        <paper-button id="exit" dialog-dismiss>
          <iron-icon icon="clear"></iron-icon>
        </paper-button>
        <h1 id="title_default" class="default">{{recipe.desc}}</h1>
        <paper-input id="title_input" class="input" label="Please name your recipe ... "></paper-input>
        <div class="content">
          <div class="leftColumn">
            <paper-material elevation="1" class="recipeImg">
            </paper-material>
            <div class="ingredients" id="incr_default" class="default">
              <template is="dom-repeat" items="{{recipe.incredients}}">
                <socobo-recipe-details-incredient incredient="{{item}}"></socobo-recipe-details-incredient>
              </template>
            </div>
            <div class="ingredients" id="incr_input" class="input">
              <template is="dom-repeat" items="{{incredient_inputs}}">
                <socobo-recipe-details-incredient state="add" id="{{item}}" on-rem_incr="removeIncr"></socobo-recipe-details-incredient>
              </template>
            </div>
            <paper-fab icon="add" id="addIncr" on-click="addIncr"></paper-fab>
          </div>
          <div class="rightColumn">
            <div id="text_default" class="default" class="text">{{recipe.text}}</div>
            <paper-textarea class="input" id="text_input"
                            rows="6"
                            label="Here you might place a brief description or the like ..." ></paper-textarea>
            <div class="steps" id="steps_default" class="default">
              <template is="dom-repeat" items="{{recipe.steps}}">
                <socobo-recipe-details-step class="step" step="{{item}}"></socobo-recipe-details-step>
              </template>
            </div>
            <div class="steps" id="steps_input" class="input">
              <template is="dom-repeat" items="{{recipe_inputs}}">
                <socobo-recipe-details-step state="add" class="step" id="{{item}}" on-rem_step="removeStep"></socobo-recipe-details-step>
              </template>
            </div>
            <paper-fab icon="add" id="addStep" on-click="addStep"></paper-fab>
          </div>
        </div>
        <div class="buttons">
          <paper-fab icon="clear" id="abort"></paper-fab>
          <paper-fab icon="done" id="ok"></paper-fab>
        </div>
      </paper-dialog>
  </template>

</dom-module>

<script>
  (function() {
    Polymer({
      is: 'socobo-recipe-details',
      listeners : {

      },
      properties: {
        recipe : {
          type : Object,
          value : {}
        },
        recipe_inputs : {
          type : Array,
          value : [
            "step0"
          ]
        },
        incredient_inputs : {
          type : Array,
          value : [
            "incr0"
          ]
        },
        state : {
          type: String,
          value: "show"
        },
        numberOfSteps : {
          type : Number,
          value : 1
        },
        numberOfIncr : {
          type : Number,
          value : 1
        }
      },
      exit : function () {
        this.fire("exit_request");
      },
      toggleDialog : function(){
        this.chooseState();
        this.$.dialog.toggle();
      },
      addStep : function () {
        //alert("Add step");
        this.push("recipe_inputs", "step" + this.numberOfSteps);
        this.numberOfSteps++;
      },
      addIncr : function () {
        //alert("Add incr");
        this.push("incredient_inputs", "incr" + this.numberOfIncr);
        this.numberOfIncr++;
      },
      removeStep : function(e){
        //alert("remove step");
        var model = e.model;
        var itemIndex = model.get('index');
        //alert(itemIndex);
        this.cutElementOffArray(itemIndex, "recipe_inputs");
      },
      removeIncr : function(e){
        //alert("remove incr");
        var model = e.model;
        var itemIndex = model.get('index');
        //alert(itemIndex);
        this.cutElementOffArray(itemIndex, 'incredient_inputs');
      },
      cutElementOffArray : function (index, arr) {
        this.splice(arr, index ,1);
      },
      chooseState :function(){
        //alert(this.state);
        if(this.state === "add"){
          this.$.addIncr.style.display = "block";
          this.$.addStep.style.display = "block";
          this.$.ok.style.display = "block";
          this.$.abort.style.display = "block";
          this.$.title_default.style.display = "none";
          this.$.title_input.style.display = "block";
          this.$.text_default.style.display = "none";
          this.$.text_input.style.display = "block";
          this.$.steps_default.style.display = "none";
          this.$.steps_input.style.display = "block";
          this.$.incr_default.style.display = "none";
          this.$.incr_input.style.display = "block";
        }
        if(this.state === "show"){
          this.$.addIncr.style.display = "none";
          this.$.addStep.style.display = "none";
          this.$.ok.style.display = "none";
          this.$.abort.style.display = "none";
          this.$.title_default.style.display = "block";
          this.$.title_input.style.display = "none";
          this.$.text_default.style.display = "block";
          this.$.text_input.style.display = "none";
          this.$.steps_default.style.display = "block";
          this.$.steps_input.style.display = "none";
          this.$.incr_default.style.display = "block";
          this.$.incr_input.style.display = "none";
        }
      }
    });
  })();
</script>


